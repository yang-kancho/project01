<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>스케쥴</title>
    <link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet" type="text/css">
    <link href="assets/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">

    <!--구글 폰트 링크-->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
          rel="stylesheet"/>

    <link href="css/theme.css" rel="stylesheet" type="text/css">
    <!-- Custom styles for this template -->
    <link href="css/offcanvas-navbar.css" rel="stylesheet" type="text/css">
    <!-- 부가적인 테마 -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .map_wrap,
        .map_wrap * {
            margin: 0;
            padding: 0;
            font-family: 'Malgun Gothic', dotum, '돋움', sans-serif;
            font-size: 12px;
        }

        .map_wrap a,
        .map_wrap a:hover,
        .map_wrap a:active {
            text-decoration: none;
        }

        .map_wrap {
            position: relative;
            width: 100%;
            height: 500px;
        }

        a {
            text-decoration: none;
            cursor: pointer;
        }

        #menu_wrap {
            position: absolute;
            top: 8vh;
            left: 0;
            bottom: 0;
            width: 300px;
            margin: 10px 0 30px 10px;
            padding: 5px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.7);
            z-index: 1;
            font-size: 12px;
            border-radius: 10px;
        }

        .bg_white {
            background: #fff;
        }
        #keyword{
            margin : 5px auto;
            width:90%;
            background-color:#edf6f9;
            height:40px;
            border-radius: 5px;
          }
      
          #menu_wrap .option form button{
            margin : 5px auto;
          }
          #placeSearchBtn{
            width: 68%;
            background-color:#caf0f8;
                
            padding: 1px;
            display: inline-block;
            border: 2px solid #666;
          }
          #placeSearchBtn:hover {
            background-color: #00b4d8;
            color: #fff;
        }
        #placeSearchCloseBtn:hover {
          background-color: #fb6f92;
          color: #fff;
      }
      
          #placeSearchCloseBtn{
            width:20%;
            background-color: #ffc2d1;
            border-radius: 5px;
          }

        #menu_wrap hr {
            display: block;
            height: 1px;
            border: 0;
            border-top: 2px solid #5F5F5F;
            margin: 3px 0;
        }

        #menu_wrap .option {
            text-align: center;
        }

        #menu_wrap .option p {
            margin: 10px 0;
        }

        #menu_wrap .option button {
            margin-left: 5px;
        }

        #placesList li {
            list-style: none;
        }

        #placesList .item {
            position: relative;
            border-bottom: 1px solid #888;
            overflow: hidden;
            cursor: pointer;
            min-height: 65px;
        }

        #placesList .item span {
            display: block;
            margin-top: 4px;
        }

        #placesList .item h5,
        #placesList .item .info {
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        #placesList .item .info {
            padding: 10px 0 10px 55px;
        }

        #placesList .info .gray {
            color: #8a8a8a;
        }

        #placesList .info .jibun {
            padding-left: 26px;
            background: url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/places_jibun.png) no-repeat;
        }

        #placesList .info .tel {
            color: #009900;
        }

        #placesList .item .markerbg {
            float: left;
            position: absolute;
            width: 36px;
            height: 37px;
            margin: 10px 0 0 10px;
            background: url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png) no-repeat;
        }

        #placesList .item .marker_1 {
            background-position: 0 -10px;
        }

        #placesList .item .marker_2 {
            background-position: 0 -56px;
        }

        #placesList .item .marker_3 {
            background-position: 0 -102px
        }

        #placesList .item .marker_4 {
            background-position: 0 -148px;
        }

        #placesList .item .marker_5 {
            background-position: 0 -194px;
        }

        #placesList .item .marker_6 {
            background-position: 0 -240px;
        }

        #placesList .item .marker_7 {
            background-position: 0 -286px;
        }

        #placesList .item .marker_8 {
            background-position: 0 -332px;
        }

        #placesList .item .marker_9 {
            background-position: 0 -378px;
        }

        #placesList .item .marker_10 {
            background-position: 0 -423px;
        }

        #placesList .item .marker_11 {
            background-position: 0 -470px;
        }

        #placesList .item .marker_12 {
            background-position: 0 -516px;
        }

        #placesList .item .marker_13 {
            background-position: 0 -562px;
        }

        #placesList .item .marker_14 {
            background-position: 0 -608px;
        }

        #placesList .item .marker_15 {
            background-position: 0 -654px;
        }

        #pagination {
            margin: 10px auto;
            text-align: center;
        }

        #pagination a {
            display: inline-block;
            margin-right: 10px;
        }

        #pagination .on {
            font-weight: bold;
            cursor: default;
            color: #777;
        }

        #pagination {
            margin: 10px auto;
            text-align: center;
        }

        #pagination a {
            display: inline-block;
            margin-right: 10px;
        }

        #pagination .on {
            font-weight: bold;
            cursor: default;
            color: #777;
        }

        #rightSideBar {
            position: absolute;
            width: 300px;
            right: 0;
            top: 51px;
            overflow-y: scroll;
            -ms-overflow-style: none;
            /* 인터넷 익스플로러 */
            scrollbar-width: none;
            /* 파이어폭스 */
            background-color: #87c4e8;
            text-align: center;
        }

        #rightSideBar::-webkit-scrollbar {
            display: none;
            /* 크롬, 사파리, 오페라, 엣지 */
        }

        #sideMenuWrap {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        #sideMenuWrap>div {
            width: 49%;
            height: 30px;
        }

        #ListContentContainer {
            position: absolute;
            top: 9vh;
            right: 0;
            background-color: #F8F9FA;
            z-index: 5;
            width: 300px;
            height: 80vh;
            text-align: center;
            overflow-y: scroll;
            -ms-overflow-style: none;
            /* 인터넷 익스플로러 */
            scrollbar-width: none;
            /* 파이어폭스 */
            cursor: default;
            border: 3px solid #a6a2a2;
        }
        #ListContentContainer::-webkit-scrollbar {
            display: none;
            /* 크롬, 사파리, 오페라, 엣지 */
        }

        #messageContentBox {
            position: absolute;
            top: 9vh;
            right: 0;
            background-color: #F8F9FA;
            z-index: 5;
            width: 300px;
            height: 80vh;
            text-align: center;
                        overflow-y: scroll;
            -ms-overflow-style: none;
            /* 인터넷 익스플로러 */
            scrollbar-width: none;
            scrollbar-width: none;
            cursor: default;
            border: 3px solid #a6a2a2;
        }
        #messageContentBox::-webkit-scrollbar {
            display: none;
            /* 크롬, 사파리, 오페라, 엣지 */
        }

        .myScheduleContent {
            line-height: 30px;
            width: 100%;
            margin-bottom: 5px;
            cursor: pointer;
            text-align: left;
            border-bottom: 1px solid #a6a2a2;
            padding: 5px 10px;
        }
        .myScheduleTime{
            font-size: 12px;
            text-align: right;
            float: right;
            color: #ff70a6;
        }

        .agreeBtn {
            margin: 0 5px;
        }

        header {
            margin: auto;
            min-width: 960px;
            width: 90%;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 51px;
        }

        .logo {
            background-position: center;
            background-size: contain;
            background-repeat: no-repeat;
            height: 100%;
            width: 150px;
            margin-left: 30px;
            display: inline-block;
            opacity: 0.8;
        }

        .headerMenuWrap {
            display: inline-block;
            color: #4b6662;
        }

        .headerMenuWrap a {
            line-height: 50px;
            text-decoration: none;
            margin: 0 30px;
            padding: 15px 50px;
            color: black;
        }

        #chatMapLink {
            color: blue;
            background-color: #87c4e8;
            font-weight: bold;
        }

        .userMenu {
            display: inline-block;
            margin-right: 30px;
            cursor: pointer;
        }

        .map_wrap {
            position: relative;
            width: 80%;
            height: 80vh;
            /* 뷰포트 높이를 활용하여 전체 높이 설정 */
        }

        /* 나머지 스타일들은 이하에 추가 */

        #pagingWrap {
            text-align: center;
            margin-top: 20px;
        }

        #pagingWrap a {
            text-decoration: none;
            color: #007bff;
            /* 링크 색상 변경 */
            margin: 0 5px;
        }

        #pagingWrap .nowPage {
            font-weight: bold;
            /* 현재 페이지 강조 스타일 */
        }

        #searchBar {
            text-align: center;
            margin-top: 20px;
        }

        #searchWord {
            border: 1px solid #ccc;
            /* 입력 필드 테두리 추가 */
            height: 30px;
            padding: 5px;
            width: 60%;
            /* 너비 조정 */
            border-radius: 4px;
        }

        #searchBtn {
            border: none;
            padding: 5px 20px;
            /* 좀 더 큰 패딩 */
            height: 40px;
            /* 높이 증가 */
            color: #fff;
            background-color: #007bff;
            /* 버튼 색상 변경 */
            border-radius: 4px;
            cursor: pointer;
        }







        body {
            font-size: 14px;
            position: relative;
            width: 100%;
            background-color: lightgrey;
            /* 더 밝은 배경 색상 */
            font-family: Arial, sans-serif;
            /* 기본 글꼴 설정 */
            margin: 0;
            /* 페이지 여백 제거 */
        }

        body::after {
            clear: both;
            content: "";
            display: block;
        }

        .map_wrap {
            font-size: 14px;
            position: relative;
            width: 100%;
            height: 1000px;
        }

        .title {
            font-weight: bold;
            display: block;
        }

        .hAddr {
            position: absolute;
            left: 10px;
            top: 10px;
            border-radius: 2px;
            background: #fff;
            background: rgba(255, 255, 255, 0.8);
            z-index: 1;
            padding: 5px;
        }

        #centerAddr {
            display: block;
            margin-top: 2px;
            font-weight: normal;
        }

        .bAddr {
            padding: 5px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        .infoWindowBox {
            width: 150px;
            height: 20px;
            font-size: 12px;
            padding: 3px;
            text-align: center;
            box-sizing: content-box;
        }

        .infoNotSecret {
            color: #34a0a4;
        }

        .infoSecret {
            color: #5D12D2;
        }

        .infoWindowBox a {
            line-height: 23px
        }


        .secretInfoWindowBox {
            position: relative;
        }

        .material-symbols-outlined {
            position: absolute;
            top: -17px;
            left: 50%;
            transform: translateX(-50%);
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 20
        }


        h2 {
            text-align: center;
            margin-top: 5px;
        }

        #thTopBar {
            margin: 20px auto 10px auto;
            padding: 5px;
            height: 5vh;
            width: 90%;
            background-color: #D9D9D9;
        }

        #thTopBar tr {
            margin: auto;
            background-color: #D9D9D9;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 5px;
        }

        #thTopBar th {
            font-weight: bold;
            text-align: center;
        }

        #writeBtn {
            float: right;
            margin-right: 7vw;
            border: none;
            background-color: blue;
            color: #fff;
            padding: 5px;
        }

        #dataTable {
            margin: auto;
            width: 90%;
            height: 70vh;
        }

        #dataTable tr {
            margin: auto;
            background-color: #D9D9D9;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        #pagingWrap {
            text-align: center;
        }

        #pagingWrap a {
            text-decoration: none;
            color: inherit;
        }

        #pagingWrap .nowPage {
            color: red;
            text-decoration: underline;
        }

        /*  스케줄생성  */

        .overlay {

            background-color: rgba(0, 0, 0, 0.5);
            border: solid rgba(0, 0, 0, 0.1) thin;
            box-shadow: rgba(0, 0, 0, 0.2) 2px 2px 10px;

        }

        #scheduleCreate {

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 228px;
            height: 300px;
            padding: 15px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: rgba(0, 0, 0, 0.2) 2px 2px 10px;
            z-index: 3;
            display: none;
            font-size: 14px;
            text-align: center;

        }

        #scheduleCreateContent {
            position: relative;
        }

        #ScheduleCloseBtn {
            position: absolute;
            top: 0px;
            right: 0px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            background-color: #61aeff;
            width: 28px;
            height: 30px;
        }

        h2 {

            text-align: center;
        }

        button[type="submit"] {
            background-color: #61aeff;
            border: none;
            border-radius: 5px;
            padding: 7px;
            display: block;
            width: 100%;
            margin-bottom: 5px;
        }

        input[type="text"],
        input[type="datetime-local"],
        textarea {
            display: block;
            width: 100%;
            margin-bottom: 3px;
            text-align: center;
        }

        #ScheduleCloseBtn:hover,
        button[type="submit"]:hover {
            background-color: #4d89c9;
            color: #fff;
        }

        #ScheduleCloseBtn:after {
            display: inline-block;
            content: "\00d7";
            font-size: 16px;
        }

        #searchAble {
            margin-bottom: 10px;
        }

        label {
            display: inline-block;
        }

        textarea {
            resize: none;
        }


        /*<!-- 스케줄 정보-- >*/

        #scheduleInfo {
            display: none;
            float: left;
            width: 225px;
            height: 300px;
            padding: 15px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: rgba(0, 0, 0, 0.1) 1px 0px 1px;
            z-index: 4;
        }

        #scheduleViewContent {
            overflow: auto;
            width: 90%;
            height: 130px;
            margin: auto;
        }

        #scheduleInfo button {
            margin-top: -5px;
            padding: 6px 10px;
            border-radius: 5px;
        }

        .viewdeleteButton {
            background-color: #e74c3c;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        .viewdeleteButton:hover {
            background-color: #c0392b;
        }

        .viewjoinButton {
            background-color: #ffb04a;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        .viewjoinButton:hover {
            background-color: #e1a531;
        }

        .viewcloseButton {
            margin-left: 15px;
            background-color: #2ecc71;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        .viewcloseButton:hover {
            background-color: #27ae60;
        }

        .viewrouteButton {
            margin-left: 15px;
            background-color: #3498db;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        .viewrouteButton:hover {
            background-color: #2980b9;
        }

        #scheduleTc {
            text-align: center;
            margin-bottom: 5px;
            font-size: 13px;
            font-weight: bold;
        }

        #scheduleT {
            margin-top: 8px;
        }

        /*<!-- 스케줄참여 목록창-- >*/
        #participantListInfo {
            display: none;
            width: 150px;
            height: 200px;
            padding: 15px 20px 20px 20px;
            float: left;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: rgba(0, 0, 0, 0.2) 1px 0px 1px;
            z-index: 3;
        }


        #listsc {
            width: 100px;
            height: 155px;
            overflow: scroll;
            -ms-overflow-style: none;
            /* 인터넷 익스플로러 */
            scrollbar-width: none;
            /* 파이어폭스 */
        }

        #listsc::-webkit-scrollbar {
            display: none;
        }


        #participantListInfo h2 {
            font-size: 12px;
        }

        #leaveButton {
            position: fixed;
            bottom: 101px;
            right: 6px;
            border: none;
            cursor: pointer;
            border-radius: 10px;
            padding: 1px 6px;
            background-color: rgba(253, 39, 39, 0.98);

        }

        #leaveButton:hover {
            background-color: rgba(197, 26, 26, 0.98);
            color: #343434;
        }

        #participantList {
            padding-left: 15px;

        }

        #infoCloseBtn {
            position: absolute;
            top: 14px;
            right: 10px;
            background-color: #61aeff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 0.8em;
            padding: 1px;

        }

        #infoCloseBtn:hover {
            background-color: #4d89c9;
            color: white;
        }

        #infoCloseBtn:after {
            display: inline-block;
            content: "\00d7";
            font-size: 20px;
        }

        #leaveButton:hover {
            background-color: rgba(197, 26, 26, 0.98);
            color: #343434;
        }

        #scheduleBox {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
        }

        h4 {
            text-align:center;
        }
        h5 {
            text-align: center;
        }

        #passwordForm {
            margin: 0px;
        }

    </style>
</head>
<script
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ce91c2d9118a2a15e5e8e7d707649985&libraries=clusterer,services"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<body>
<header>
    <svg class="d-none" xmlns="http://www.w3.org/2000/svg">
        <symbol id="check2" viewBox="0 0 16 16">
            <path
                    d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
        </symbol>
        <symbol id="circle-half" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
        </symbol>
        <symbol id="moon-stars-fill" viewBox="0 0 16 16">
            <path
                    d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
            <path
                    d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
        </symbol>
        <symbol id="sun-fill" viewBox="0 0 16 16">
            <path
                    d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </symbol>
    </svg>
    <div class="dropdown position-fixed bottom-0 end-0 mb-3 me-3 bd-mode-toggle">
        <button aria-expanded="false" aria-label="Toggle theme (auto)"
                class="btn btn-bd-primary py-2 dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown" id="bd-theme" type="button">
            <svg class="bi my-1 theme-icon-active" height="1em" width="1em">
                <use href="#circle-half"></use>
            </svg>
            <span class="visually-hidden" id="bd-theme-text">Toggle theme</span>
        </button>
        <ul aria-labelledby="bd-theme-text" class="dropdown-menu dropdown-menu-end shadow">
            <li>
                <button aria-pressed="false" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light"
                        type="button">
                    <svg class="bi me-2 opacity-50 theme-icon" height="1em" width="1em">
                        <use href="#sun-fill"></use>
                    </svg>
                    Light
                    <svg class="bi ms-auto d-none" height="1em" width="1em">
                        <use href="#check2"></use>
                    </svg>
                </button>
            </li>
            <li>
                <button aria-pressed="false" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark"
                        type="button">
                    <svg class="bi me-2 opacity-50 theme-icon" height="1em" width="1em">
                        <use href="#moon-stars-fill"></use>
                    </svg>
                    Dark
                    <svg class="bi ms-auto d-none" height="1em" width="1em">
                        <use href="#check2"></use>
                    </svg>
                </button>
            </li>
            <li>
                <button aria-pressed="true" class="dropdown-item d-flex align-items-center active"
                        data-bs-theme-value="auto" type="button">
                    <svg class="bi me-2 opacity-50 theme-icon" height="1em" width="1em">
                        <use href="#circle-half"></use>
                    </svg>
                    Auto
                    <svg class="bi ms-auto d-none" height="1em" width="1em">
                        <use href="#check2"></use>
                    </svg>
                </button>
            </li>
        </ul>
    </div>
    <nav aria-label="Main navigation" class="navbar navbar-expand-lg fixed-top bg-body-tertiary">
        <div class="container-fluid">
            <ul class="navbar-nav mb-2 mb-lg-0">
                <li class="nav-item ">
                    <a aria-expanded="false" href="/mainPage">
                        <img alt="" class="rounded-circle" height="60" src="image/logo.jpg" width="60">
                    </a>
                </li>
            </ul>
            <button aria-label="Toggle navigation" class="navbar-toggler p-0 border-0" id="navbarSideCollapse"
                    type="button">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="navbar-collapse offcanvas-collapse bg-body-tertiary" id="navbarsExampleDefault">


                <ul class="navbar-nav ms-auto mb-2 mb-lg-0" style="text-align: center;">

                    <!--
              현재페이지 밝게 <a class="nav-link active" onclick="boardMap()" aria-current="page">게시판</a>
             -->
                    <div class="vr"></div>
                    <li class="nav-item" style="width: 200px; font-size: large; ">
                        <a class="nav-link" onclick="openSearchMenu()">장소검색</a>
                    </li>
                    <div class="vr"></div>
                    <li class="nav-item" style="width: 200px; font-size: large;">
                        <a class="nav-link " onclick="boardMap()">게시판</a>
                    </li>
                    <div class="vr"></div>
                    <li  class="nav-item" style="width: 200px; font-size: large;">
                        <a class="nav-link" onclick="chatMap()">채팅방</a>
                    </li>
                    <div class="vr"></div>
                    <li aria-current="page" class="nav-item " style="width: 200px; font-size: large;">
                        <a class="nav-link active" onclick="scheduleMap()">스케줄</a>
                    </li>
                    <div class="vr"></div>
                </ul>

                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                           href="#">[[${nickName}]]</a>
                        <ul class="dropdown-menu dropdown-menu-end ">
                            <li><a class="dropdown-item" href="/update">개인정보</a></li>
                            <li><a class="dropdown-item" onclick="userWindowOpen()">우편함</a></li>
                            <li><a class="dropdown-item" onclick="messageListOnOff()">메세지</a></li>
                            <li><a class="dropdown-item" onclick="scheduleMenuOnOff()">참여한 스케쥴</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="/logout">로그아웃</a></li>
                        </ul>
                    </li>
                </ul>


            </div>
        </div>
        <div id="rightSideBar" style="display:none;">
            <div id="sideMenuWrap">
                <div id="visitMenu" onclick="scheduleMenuOnOff()">참여한 스케쥴</div>
                <div id="myPost" onclick="userWindowOpen()">우편함</div>
                <div id="directMessage" onclick="messageListOnOff()">메시지</div>
            </div>
        </div>
        <div id="myScheduleListMenu" style="display:none">
            <div id="ListContentContainer"></div>
        </div>
        <div id="letterBox">
            <div id="letterContentContainer"></div>
        </div>
        <div id="messageBox" style="display:none">
            <div id="messageContentBox"></div>
        </div>
    </nav>
</header>

<div id="chatListMenu" style="display:none">
    <div id="myMenuListContentContainer"></div>
</div>


<div id="mapWrap">
    <div id="map" style="width:90vw;height:80vh;margin:auto;"></div>
    <div class="bg_white" id="menu_wrap" style="display:none;">
        <div class="option">
            <div>
              <form onsubmit="searchPlaces(); return false;">
                키워드로 검색하기 <input id="keyword" size="15" type="text" value="">
                <button type="submit" id="placeSearchBtn">검색하기</button>
                <button type="button" onclick="closeSearchMenu();" id="placeSearchCloseBtn">닫기</button>
              </form>
            </div>
          </div>
        <hr>
        <ul id="placesList"></ul>
        <div id="pagination"></div>
    </div>
</div>


<div class="overlay" id="scheduleCreate">
    <div id="scheduleCreateContent">
        <button id="ScheduleCloseBtn" onclick="ScheduleClose()"></button>
        <form action="/schedule/writeSchedule" method="post" onsubmit="return scheduleTimeCheck();">
            <h5>스케줄 생성</h5>
            <input id="scheduleTitle" name="scheduleTitle" placeholder="제목" required type="text">
            <input id="scheduleTime" name="datetime" placeholder="날짜" required type="datetime-local">
            <input id="admin" name="admin" type="hidden">
            <input id="lat" name="lat" required type="hidden">
            <input id="lng" name="lng" required type="hidden">
            <input id="address" name="address" type="hidden">
            <textarea id="scheduleContent" name="content" placeholder="내용" required></textarea>
            <div id="searchAble">
                <label>공개<input checked name="secret" onchange="passwordOff()" type="radio" value="0"/></label>
                <label>비공개<input name="secret" onchange="passwordON()" type="radio" value="1"/></label>
            </div>
            <p id="passwordForm" style="display:none;">
                비밀번호 :<input id="password" name="password" type="password"/>
            </p>
            <br/>
            <button type="submit">저장</button>
        </form>
    </div>
</div>

<div id="scheduleBox">
    <div id="scheduleInfo">
        <h2 id="scheduleViewTitle"></h2>
        <p id="scheduleDateTime"></p>
        <div id="viewContent">
            <p id="scheduleViewContent"></p>
        </div>
        <div id="buttonBox">
            <button class="viewdeleteButton" id="viewdeleteButton">삭제</button>
            <button class="viewrouteButton" id="viewrouteButton">길찾기</button>
            <button class="viewcloseButton" id="viewcloseButton">닫기</button>
        </div>
    </div>


    <div class="participantListInfo" id="participantListInfo" style="display: none;">
        <button id="infoCloseBtn" onclick="closeParticipantList()"></button>
        <h2>참여자 목록</h2>
        <div id="listsc">
            <ul id="participantList"></ul>
        </div>
    </div>
</div>


<script th:inline="javascript">

    var mapContainer = document.getElementById('map');
    var mapOption = {
        center: new kakao.maps.LatLng(37.268, 127.0007), // 세션 유저데이터에 저장된 좌표값을 초기값으로 넣어줄 예정
        level: 3,
        mapTypeId: kakao.maps.MapTypeId.ROADMAP
    }
    var map = new kakao.maps.Map(mapContainer, mapOption);
    //----------------------------------------------장소검색 API------------------------------------------------------------------------------------
    var markers2 = [];
    var ps = new kakao.maps.services.Places();
    var infowindow2 = new kakao.maps.InfoWindow({ zIndex: 1 });
    function searchPlaces() {

        var keyword = document.getElementById('keyword').value;

        if (!keyword.replace(/^\s+|\s+$/g, '')) {
            alert('키워드를 입력해주세요!');
            return false;
        }

        // 장소검색 객체를 통해 키워드로 장소검색을 요청합니다
        ps.keywordSearch(keyword, placesSearchCB);
    }
    function placesSearchCB(data, status, pagination) {
        if (status === kakao.maps.services.Status.OK) {

            // 정상적으로 검색이 완료됐으면
            // 검색 목록과 마커를 표출합니다
            displayPlaces(data);

            // 페이지 번호를 표출합니다
            displayPagination(pagination);

        } else if (status === kakao.maps.services.Status.ZERO_RESULT) {

            alert('검색 결과가 존재하지 않습니다.');
            return;

        } else if (status === kakao.maps.services.Status.ERROR) {

            alert('검색 결과 중 오류가 발생했습니다.');
            return;

        }
    }
    // 검색 결과 목록과 마커를 표출하는 함수입니다
    function displayPlaces(places) {

        var listEl = document.getElementById('placesList'),
            menuEl = document.getElementById('menu_wrap'),
            fragment = document.createDocumentFragment(),
            bounds = new kakao.maps.LatLngBounds(),
            listStr = '';
        removeAllChildNods(listEl);



        for (var i = 0; i < places.length; i++) {

            // 마커를 생성하고 지도에 표시합니다
            var placePosition = new kakao.maps.LatLng(places[i].y, places[i].x),
                marker = addMarker2(placePosition, i),
                itemEl = getListItem(i, places[i]); // 검색 결과 항목 Element를 생성합니다

            // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
            // LatLngBounds 객체에 좌표를 추가합니다
            bounds.extend(placePosition);

            // 마커와 검색결과 항목에 mouseover 했을때
            // 해당 장소에 인포윈도우에 장소명을 표시합니다
            // mouseout 했을 때는 인포윈도우를 닫습니다
            (function (marker, title) {
                kakao.maps.event.addListener(marker, 'mouseover', function () {
                    displayInfowindow(marker, title);
                });

                kakao.maps.event.addListener(marker, 'mouseout', function () {
                    infowindow2.close();
                });

                itemEl.onmouseover = function () {
                    displayInfowindow(marker, title);
                };

                itemEl.onmouseout = function () {
                    infowindow2.close();
                };
            })(marker, places[i].place_name);

            fragment.appendChild(itemEl);
        }

        // 검색결과 항목들을 검색결과 목록 Element에 추가합니다
        listEl.appendChild(fragment);
        menuEl.scrollTop = 0;

        // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
        map.setBounds(bounds);
    }
    // 검색결과 항목을 Element로 반환하는 함수입니다
    function getListItem(index, places) {

        var el = document.createElement('li'),
            itemStr = '<span class="markerbg marker_' + (index + 1) + '"></span>' +
                '<div class="info">' +
                '   <h5>' + places.place_name + '</h5>';

        if (places.road_address_name) {
            itemStr += '    <span>' + places.road_address_name + '</span>' +
                '   <span class="jibun gray">' + places.address_name + '</span>';
        } else {
            itemStr += '    <span>' + places.address_name + '</span>';
        }

        itemStr += '  <span class="tel">' + places.phone + '</span>' +
            '</div>';

        el.innerHTML = itemStr;
        el.className = 'item';

        return el;
    }
    // 마커를 생성하고 지도 위에 마커를 표시하는 함수입니다
    function addMarker2(position, idx, title) {
        var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // 마커 이미지 url, 스프라이트 이미지를 씁니다
            imageSize = new kakao.maps.Size(36, 37),  // 마커 이미지의 크기
            imgOptions = {
                spriteSize: new kakao.maps.Size(36, 691), // 스프라이트 이미지의 크기
                spriteOrigin: new kakao.maps.Point(0, (idx * 46) + 10), // 스프라이트 이미지 중 사용할 영역의 좌상단 좌표
                offset: new kakao.maps.Point(13, 37) // 마커 좌표에 일치시킬 이미지 내에서의 좌표
            },
            markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
            marker = new kakao.maps.Marker({
                position: position, // 마커의 위치
                image: markerImage
            });

        marker.setMap(map); // 지도 위에 마커를 표출합니다
        markers2.push(marker);  // 배열에 생성된 마커를 추가합니다

        return marker;
    }
    // 지도 위에 표시되고 있는 마커를 모두 제거합니다
    function removeMarker() {
        for (var i = 0; i < markers2.length; i++) {
            markers2[i].setMap(null);
        }
        markers2 = [];
    }
    // 검색결과 목록 하단에 페이지번호를 표시는 함수입니다
    function displayPagination(pagination) {
        var paginationEl = document.getElementById('pagination'),
            fragment = document.createDocumentFragment(),
            i;

        // 기존에 추가된 페이지번호를 삭제합니다
        while (paginationEl.hasChildNodes()) {
            paginationEl.removeChild(paginationEl.lastChild);
        }

        for (i = 1; i <= pagination.last; i++) {
            var el = document.createElement('a');
            el.href = "#";
            el.innerHTML = i;

            if (i === pagination.current) {
                el.className = 'on';
            } else {
                el.onclick = (function (i) {
                    return function () {
                        pagination.gotoPage(i);
                    }
                })(i);
            }

            fragment.appendChild(el);
        }
        paginationEl.appendChild(fragment);
    }
    // 검색결과 목록 또는 마커를 클릭했을 때 호출되는 함수입니다
    // 인포윈도우에 장소명을 표시합니다
    function displayInfowindow(marker, title) {
        var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

        infowindow2.setContent(content);
        infowindow2.open(map, marker);
    }

    // 검색결과 목록의 자식 Element를 제거하는 함수입니다
    function removeAllChildNods(el) {
        while (el.hasChildNodes()) {
            el.removeChild(el.lastChild);
        }
    }
    function closeSearchMenu() {
        var listEl = document.getElementById('placesList')
        var menuEl = document.getElementById('menu_wrap');
        removeAllChildNods(listEl);
        menuEl.style.display = 'none';
        removeMarker();
    }
    function openSearchMenu() {
        var menuEl = document.getElementById('menu_wrap');
        menuEl.style.display = 'block';
    }

    //--------------------------------------------------장소검색 API--------------------------------------------------------------------------------

    function scheduleTimeCheck() {
        var inputTime = new Date(document.getElementById("scheduleTime").value);
        var localTime = new Date();
        if (inputTime < localTime) {
            alert("현재시간 이후의 스케쥴만 생성할 수 있습니다.");
            return false; // 폼 제출 중단
        } else {
            return true; // 폼 제출 허용
        }
    }




    // Kakao Maps SDK 로딩이 완료되면 실행
    window.onload = function () {

        console.log([[${ userId }]]);
        console.log([[${ nickName }]]);

        var clusterer = new kakao.maps.MarkerClusterer({
            map: map,
            averageCenter: true,
            minLevel: 6 // 클러스터를 최소 지도 레벨 6에서 표시
        })
        // 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
        var mapTypeControl = new kakao.maps.MapTypeControl();

        // 지도에 컨트롤을 추가해야 지도위에 표시됩니다
        // kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
        map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

        // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
        var zoomControl = new kakao.maps.ZoomControl();
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
        var infowindows = [];
        var markers = [];

        /*[# th:each="schedule : ${schedule}"]*/
        var marker = new kakao.maps.Marker({
            position: new kakao.maps.LatLng(/*[[${schedule.lat}]]*/, /*[[${schedule.lng}]]*/),
            map: map
        })
        var scheduleTitle = [[${ schedule.scheduleTitle }]];
        var scheduleId = [[${ schedule.id }]];
        var scheduleSecret = [[${ schedule.secret }]];


        if (scheduleSecret == 1) {
            var infowindow = new kakao.maps.InfoWindow({
                content: '<div class="infoWindowBox secretInfoWindowBox"><span class="material-symbols-outlined">lock</span><a style="margin:auto;" class="infoSecret" onclick="secretJoin(' + scheduleId + ')">' + scheduleTitle + '</a></div>',
                removable: true,
                zIndex: 1
            })
        } else {
            var infowindow = new kakao.maps.InfoWindow({
                content: '<div class="infoWindowBox"><a style="margin:auto;" class="infoNotSecret" onclick="ScheduleViewForm([[${schedule.id}]])">' + scheduleTitle + '</a></div>',
                removable: true,
                zIndex: 1
            })

        }

        infowindow.open(map, marker);
        infowindows.push(infowindow);

        markers.push({ marker: marker, infowindow: infowindow });

        /*[/]*/

        // 인포윈도우를 닫는 클로저를 만드는 함수
        function makeOutListener(infowindow) {
            return function () {
                infowindow.close()
            }
        }

        // 인포윈도우를 표시하는 클로저를 만드는 함수
        function makeOverListener(map, marker, infowindow) {
            return function () {
                infowindow.open(map, marker)
            }
        }

        for (var i = 0; i < markers.length; i++) {
            kakao.maps.event.addListener(markers[i].marker, 'click', (function (infowindow, marker) {
                return function () {
                    infowindow.open(map, marker);
                };
            })(markers[i].infowindow, markers[i].marker));
        }

        kakao.maps.event.addListener(map, 'zoom_changed', function () {
            // 현재 줌 레벨을 가져옴
            var currentZoomLevel = map.getLevel()

            // 만약 줌 레벨이 5 이하라면 모든 인포 윈도우를 열어줌
            if (currentZoomLevel > 4) {
                for (var i = 0; i < markers.length; i++) {
                    makeOutListener(markers[i].infowindow)()
                }
            } else {
                for (var i = 0; i < markers.length; i++) {
                    makeOverListener(map, markers[i].marker, markers[i].infowindow)();
                }
            }
        })

        clusterer.addMarkers(
            markers.map(function (item) {
                return item.marker
            })
        )

        var clickMarker = new kakao.maps.Marker({
            // 지도 중심좌표에 마커를 생성
            position: map.getCenter()
        })
        var clickInfowindow = new kakao.maps.InfoWindow({
            removable: true,
            zIndex: 2
        })
        // 지도에 클릭 이벤트를 등록합니다
        // 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출

        var userId = "[[${userId}]]";

        kakao.maps.event.addListener(map, 'click', function (mouseEvent) {
            // 클릭한 위도, 경도 정보를 가져옴
            var latlng = mouseEvent.latLng

            // 마커 위치를 클릭한 위치로 옮깁
            clickMarker.setPosition(latlng);
            let clickLat = clickMarker.getPosition().getLat();
            let clickLng = clickMarker.getPosition().getLng();
            let adminId = userId;
            clickInfowindow.setContent('<div class="infoWindowBox" style="border-radius: 5px;"><a style="padding:5px;text-align:center;z-index:3;" onclick="createSchedule(' + clickLat + ',' + clickLng + ',' + adminId + ')">스케줄 생성</a></div>');
            // 지도에 마커를 표시
            clickMarker.setMap(map);

            clickInfowindow.open(map, clickMarker)
        })

        //윈도우 온로드끝
    }


    //-------------------- --------------------사이드바 메뉴 관련 함수----------------------------------------

    var userMenuToggle = 0;
    var scheduleMenuToggle = 0;
    var letterListToggle = 0;
    var rightSideBar = document.getElementById('rightSideBar');
    var scheduleMenu = document.getElementById('myScheduleListMenu');
    var messageMenu = document.getElementById('messageBox');
    function viewSideBar() {
        rightSideBar.style.display = 'block';
        rightSideBar.style.zIndex = '5';
    }
    function closeSideBar() {
        rightSideBar.style.display = 'none';
        scheduleMenu.style.display = 'none';
        messageMenu.style.display = 'none';
    }

    function userMenuToggleView() {
        if (userMenuToggle == 0) {
            viewSideBar()
            userMenuToggle = 1;
        } else {
            closeSideBar();
            userMenuToggle = 0;
            scheduleMenuToggle = 0;
            letterListToggle = 0;
        }
    }

    function scheduleMenuOnOff() {
        if (scheduleMenuToggle == 0) {
            scheduleMenu.style.display = 'block';
            scheduleMenuToggle = 1;
            letterListToggle = 0;
            messageMenu.style.display = 'none';
            myScheduleListView();

        } else {
            scheduleMenu.style.display = 'none';
            scheduleMenuToggle = 0;
            var menuContainer = document.getElementById('ListContentContainer');
            menuContainer.innerHTML = "";
        }
    }
    function messageListOnOff() {
        if (letterListToggle == 0) {
            messageMenu.style.display = 'block';
            scheduleMenu.style.display = 'none';
            scheduleMenuToggle = 0;
            letterListToggle = 1;
            letterListView();

        } else {
            messageMenu.style.display = 'none';
            letterListToggle = 0;
            var menuContainer = document.getElementById('messageContentBox');
            menuContainer.innerHTML = "";
        }
    }
    function myScheduleListView() {
        var menuContainer = document.getElementById('ListContentContainer');
        var sideMenu = document.getElementById('myScheduleListMenu');
        $.ajax({
            type: 'get',
            url: '/myScheduleViewById?id=' + currentUserId,
            dataType: 'json',
            success: function (data) {
                menuContainer.innerHTML = "";
                if (data != null && data != "") {
                    for (var i = 0; i < data.length; i++) {
                        var entityTimestamp = new Date(data[i].datetime);
                        // 현재 시간을 가져오기
                        var currentTimestamp = new Date();
                        // 두 날짜 간의 차이 계산 (밀리초 단위)
                        var timeDifference = entityTimestamp - currentTimestamp;
                        // 포맷을 결정
                        let formattedTime;
                        if (timeDifference < 3600000) { // 1시간 미만 (밀리초 단위)
                            const minutes = Math.floor(timeDifference / 60000); // 밀리초를 분으로 변환
                            formattedTime = `${minutes}분 남음`;
                        } else if (timeDifference < 86400000) { // 1일 미만 (밀리초 단위)
                            const hours = Math.floor(timeDifference / 3600000); // 밀리초를 시간으로 변환
                            formattedTime = `${hours}시간 남음`;
                        } else { // 1일 이상
                            const days = Math.floor(timeDifference / 86400000); // 밀리초를 일로 변환
                            formattedTime = `${days}일 후`;
                        }
    
                        var listBuild = '<div class="myScheduleContent" onclick="ScheduleViewForm(' + data[i].id + ')">' + data[i].scheduleTitle + '<span class="myScheduleTime">'+formattedTime+'</span></div>';
                        $("#ListContentContainer").append(listBuild);
                    }
                }
            }
        })
    }
    function userWindowOpen() {
        window.open('/userMenu/userwindow', '우편함', "width = 450px,height = 600px, top = 50px, left = 100px, scrollbars = no, location = no,scrollbars = no")
    }

    function letterListView() {
        var menuContainer = document.getElementById('messageContentBox');
        var sideMenu = document.getElementById('messageBox');
        $.ajax({
            type: 'get',
            url: '/friendRequestCheck?userId=' + currentUserId,
            dataType: 'json',
            success: function (data) {
                menuContainer.textContent = "";
                if (data != null && data != "" && data.length != 0) {
                    for (var i = 0; i < data.length; i++) {
                        var listBuild = '<div class="myBoardContent"">' + data[i].fromNickname + '님으로부터의 친구요청</div>';
                        listBuild += '<button class="agreeBtn" onclick="agreeRequest(' + data[i].id + ',1)">수락</button>';
                        listBuild += '<button class="agreeBtn" onclick="agreeRequest(' + data[i].id + ',0)">거절</button>';
                        $("#messageContentBox").append(listBuild);
                    }
                } else {
                    var listBuild = '<div class="myBoardContent"">메시지가 없습니다.</div>';
                    $("#messageContentBox").append(listBuild);
                }
            }
        })
    }
    function agreeRequest(id, answer) {
        $.ajax({
            type: 'get',
            url: '/friendRequestAnswer?id=' + id + '&type=' + answer,
            dataType: 'json',
            success: function (data) {
                if (data == 0) {
                    alert("거절하셨습니다.");
                } else {
                    alert("수락하셨습니다.");
                }
                letterListView();
            }
        })
    }
    //-------------------- --------------------사이드바 메뉴 관련 함수----------------------------------------


    var createScheduleForm = document.getElementById("scheduleCreate");

    var passwordForm = document.getElementById('passwordForm');
    var passwordInput = document.getElementById('password')
    //스케줄생성
    function passwordON() {
        passwordForm.style.display = "block";
        passwordInput.value = "";
    }
    function passwordOff() {
        passwordForm.style.display = "none"
        passwordInput.value = "";
    }
    function createSchedule(lat, lng, id) {
        scheduleInfo.style.display = 'none';
        let inputAdmin = document.getElementById("admin");
        let inputLat = document.getElementById("lat");
        let inputLng = document.getElementById("lng");

        inputAdmin.value = id;
        inputLat.value = lat;
        inputLng.value = lng;


        createScheduleForm.style.display = "block";
        document.getElementById("scheduleTitle").focus();
    }

    function ScheduleClose() {

        createScheduleForm.style.display = 'none';
        var inputTitle = document.getElementById("scheduleTitle");
        inputTitle.value = null;
        var inputpassword = document.getElementById("password");
        inputpassword.value = null;

    }

    ///
    var currentUserId = "[[${userId}]]";
    var scheduleInfo = document.getElementById("scheduleInfo");
    var nickname = [[${ nickName }]];

    //비밀방 조인
    function secretJoin(id) {
        $.ajax({
            type: 'get',
            url: '/schedulePasswordCheck?scheduleId=' + id + '&userId=' + currentUserId,
            dataType: 'json',
            success: function (data) {
                if (data == '-1') {
                    ScheduleViewForm(id);
                } else {
                    if (data == prompt("비밀번호를 입력해 주세요.")) {
                        ScheduleViewForm(id);
                    } else {
                        alert("비밀번호가 틀렸습니다.");
                    }
                }
            }
        })

    }

    //스케줄 정보를 가져오고 보여주는 함수
    function ScheduleViewForm(id) {
        $.ajax({
            url: "/schedules/" + id,
            type: "GET",
            dataType: 'json',
            success: function (data) {
                console.log(data);

                // 스케줄 정보를 사용하여 화면에 직접 표시
                var schedule = data;

                scheduleInfo.style.display = 'block';  // 스케줄 정보를 표시

                var formattedDateTime = formatDateTime(data.datetime);//시간형식변환
                map.setCenter(new kakao.maps.LatLng(data.lat, data.lng));

                scheduleInfo.innerHTML =
                    "<h4>" + data.scheduleTitle + "</h4>" +
                    "<p id='scheduleTc'>스케줄 시간" + "</p>" +
                    "<p id='scheduleT'>" + formattedDateTime + "</p>" +
                    "<p id='scheduleViewContent'>" + data.content + "</p>";

                if (data.secret == 1) {
                    displayParticipants(id);
                }

                //참여 버튼
                var joinButton = document.createElement("button");
                joinButton.textContent = "참여";
                joinButton.className = "viewjoinButton";

                if (currentUserId == data.admin) {
                    joinButton.disabled = true;
                    joinButton.style.display = 'none';
                    displayParticipants(id)
                } else {
                    joinButton.addEventListener("click", function () {
                        joinSchedule(id);
                        displayParticipants(id)
                    });
                    displayParticipants(id)
                }
                scheduleInfo.appendChild(joinButton);


                //삭제버튼
                var deleteButton = document.createElement("button");
                deleteButton.textContent = "삭제";
                deleteButton.className = "viewdeleteButton";
                if (currentUserId == schedule.admin) {
                    // 작성자와 로그인유저 Id를 비교하여 같을 경우에만 활성화
                    deleteButton.addEventListener("click", function () {
                        deleteSchedule(id);
                    });
                } else {
                    // 작성자와 로그인유저 다를 경우 버튼을 비활성화
                    deleteButton.disabled = true;
                    deleteButton.style.display = 'none';
                }
                scheduleInfo.appendChild(deleteButton);


                //길찾기버튼
                var findRouteButton = document.createElement("button");
                findRouteButton.textContent = "길찾기";
                findRouteButton.className = "viewrouteButton";
                findRouteButton.addEventListener("click", function () {
                    var lat = schedule.lat;
                    var lng = schedule.lng;
                    findRoute(lat, lng)
                });
                scheduleInfo.appendChild(findRouteButton);

                //닫기버튼
                var closeButton = document.createElement("button");
                closeButton.textContent = "닫기";
                closeButton.className = "viewcloseButton";
                closeButton.addEventListener("click", closeOverlay);
                scheduleInfo.appendChild(closeButton);


                //날짜형식 한국식으로 바꾸기
                function formatDateTime(dateTimeStr) {
                    const options = {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    };
                    const dateTime = new Date(dateTimeStr);
                    return dateTime.toLocaleString('ko-KR', options);

                }


            },
            error: function () {
                alert("스케줄 정보를 불러오는데 실패했습니다.");
            }
        });
    }

    //카카오맵 길찾기 함수
    var geocoder = new kakao.maps.services.Geocoder();
    function findRoute(lat, lng) {
        // 좌표를 주소로 변환
        geocoder.coord2Address(lng, lat, function (result, status) {
            if (status === kakao.maps.services.Status.OK) {
                var destination = result[0].address.address_name; // 도착지 주소
                console.log('주소= ' + destination + ' 위도 = ' + lat + ' 경도 = ' + lng);
                // 주소가 제대로 변환되었다면, 길찾기 페이지로 이동
                if (destination) {
                    // 카카오맵 길찾기 페이지 URL
                    window.open(`https://map.kakao.com/link/to/${destination},${lat},${lng}`);
                    // 새 창에서 길찾기 페이지 열기
                } else {
                    alert('도착지 주소를 찾을 수 없습니다.');
                }
            } else {
                alert('좌표를 주소로 변환하는데 실패하였습니다.');
            }
        });
    }
    // 스케줄 삭제 함수
    function deleteSchedule(id) {
        // 서버에 삭제 요청 보내기 (Ajax 사용)
        $.ajax({
            url: '/scheduleDelete/' + id,
            type: 'DELETE',
            success: function () {
                // 삭제 성공 시 실행할 코드
                console.log('스케줄이 삭제되었습니다.');
                location.reload();
            },
            error: function () {
                // 삭제 실패 시 실행할 코드
                console.error('스케줄 삭제 실패');
            }
        });
        scheduleInfo.style.display = 'none';
    }



    // 스케줄 생성 닫기 함수
    function closeOverlay() {
        scheduleInfo.style.display = 'none';
        participantListInfo.style.display = 'none';
        var displayLocation = document.getElementById("scheduleInfo");
        displayLocation.innerHTML = '';
    }
    //////////////////// ESC 닫기//////////////////////////

    //ESC누르면 생성창 꺼지는 함수
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            scheduleInfo.style.display = 'none';
            createScheduleForm.style.display = 'none';
            participantListInfo.style.display = 'none';

        }
    });
    ///////////////////////////

    // 참여 버튼을 누를 때 실행되는 함수
    function joinSchedule(id) {

        $.ajax({
            url: '/joinSchedule/' + id + '?nickname=' + nickname,
            type: 'POST',
            dataType: 'text',
            success: function (response) {
                console.log(id);
                alert(response);
            },
            error: function () {
                alert('참여에 실패했습니다.');
            }
        });
    }

    // 참여자 목록을 표시하는 함수
    function displayParticipants(id) {
        $.ajax({
            url: '/getParticipants/' + id,
            type: 'GET',
            dataType: 'json',
            success: function (participants) {
                var participantListInfo = document.getElementById("participantListInfo");
                var participantList = document.getElementById("participantList");
                participantList.innerHTML = ''; // 목록 초기화

                if (participants.length > 0) {
                    participantListInfo.style.display = 'block'; // 참여자 목록 표시

                    var title = "<h2>참여자 목록" +
                        "<span style='font-size: 0.5em; cursor:pointer;' onclick='closeParticipantList()'> x</span></h2>";



                    // 참여자 목록에 추가
                    participants.forEach(function (participant) {
                        var listItem = document.createElement('li');
                        listItem.textContent = participant.nickname;
                        participantList.appendChild(listItem);
                    });

                    // "나가기" 버튼 생성
                    var leaveButton = document.createElement("button");
                    leaveButton.textContent = "불참";
                    leaveButton.id = "leaveButton"; // ID를 설정
                    leaveButton.addEventListener("click", function () {
                        leaveSchedule(id, nickname); // "leaveSchedule" 함수에 ID와 nickname을 전달
                    });
                    participantListInfo.appendChild(leaveButton);

                }
            },
            error: function () {
                alert('참여자 목록을 가져오는데 실패했습니다.');
            }
        });
        var participantListInfo = document.getElementById("participantListInfo");
        participantListInfo.style.display = 'block';
    }
    // 참여자 목록 창을 닫는 함수
    function closeParticipantList() {
        var participantListInfo = document.getElementById("participantListInfo");
        participantListInfo.style.display = 'none';
    }


    // 참여자를 스케줄에서 제거하는 함수
    function leaveSchedule(id, nickname) {
        console.log(id);
        $.ajax({
            url: '/leaveSchedule/' + id + '/' + nickname,
            type: 'DELETE',
            dataType: 'text',
            success: function (response) {
                alert(response);
                location.reload();
            },
            error: function () {
                alert('스케줄에서 나가는데 실패했습니다.');
            }
        });
    }


</script>
<!-- bootstrap.bundle.min -->
<script src="assets/dist/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<!-- color-mode -->
<script src="assets/js/color-modes.js" type="text/javascript"></script>
<!-- offcanvas-navbar -->
<script src="js/offcanvas-navbar.js" type="text/javascript"></script>
<!-- index -->
<script src="js/index.js" type="text/javascript"></script>

</body>

</html>